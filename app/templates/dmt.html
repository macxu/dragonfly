<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <title>Dragonfly | Test Management Portal </title>

    <link href="/static/images/dragonfly-icon.png" rel="icon"><!-- Bootstrap Core CSS-->
    <link href="/static/css/c3.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet"><!-- Custom CSS-->
    <link href="/static/css/sb-admin.css" rel="stylesheet"><!-- Morris Charts CSS-->
    <link href="/static/css/test-manager.css" rel="stylesheet"><!-- Custom Fonts-->
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')--><!-- Morris Charts JavaScript--><!-- jQuery-->

    <script src="/static/js/jquery.js"></script>

    <script src="/static/js/bootstrap.min.js"></script>

</head>

<body>
<div id="wrapper-wide">
    <!-- Navigation-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display-->
        <div class="navbar-header">
            <button class="navbar-toggle" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><img class="logo navbar-logo" src="/static/images/dragonfly-icon.png"><a class="navbar-brand" href="/">Dragonfly | DMT Validation Report</a>
        </div><!-- Top Menu Items-->

    </nav>
    <div id="page-wrapper">
        <div class="container-fluid" id="divContainer">

            <div class="row panel panel-default">
                <div class="col-md-12">
                    <div class="row" style="height:100%">
                        <form>
                            <div class="radio text-center">
                                <label><input id="vo_campaign" type="radio" name="optradio" checked="checked" onchange="selectedVoTypeChanged()"> Campaign </label>
                                <label><input id="vo_group" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Group </label>
                                <label><input id="vo_keyword" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Keyword </label>
                                <label><input id="vo_creative" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Creative </label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-7">
                        <div class="input-group">
                            <span class="input-group-addon">1.0 Client ID</span>
                            <input class="form-control" id="client_id_10" value="12654910" placeholder="12654910">
                        </div>
                    </div>
                    <div class="col-md-5">
                        <button type="button" class="btn btn-primary" onclick="loadMysqlData()">Get Data ( By Mysql )</button>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
            </div>
            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-7">
                        <div class="input-group">
                            <span class="input-group-addon">2.0 Client ID</span>
                            <input class="form-control" id="client_id_20" value="4338988" placeholder="4338988">
                        </div>
                    </div>
                    <div class="col-md-5">
                        <button type="button" class="btn btn-primary" onclick="loadPrestoData()">Get Data ( By Presto )</button>
                    </div>
                </div>
            </div>

            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-12">
                        <div class="input-group">
                            <span class="input-group-addon">Client Name</span>
                            <input class="form-control" id="client_name_10" value="" placeholder="">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
            </div>
            <div class="col-md-5">
                <div class="row">
                    <div class="col-md-12">
                        <div class="input-group">
                            <span class="input-group-addon">Client Name</span>
                            <input class="form-control" id="client_name_20" value="" placeholder="">
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-md-5">
                <div class="form-group">
                  <textarea class="form-control" rows="20" id="mysql_data"></textarea>
                </div>
            </div>
            <div class="col-md-2">
            </div>
            <div class="col-md-5">
                <div class="form-group">
                  <textarea class="form-control" rows="20" id="presto_data"></textarea>
                </div>
            </div>


            <div class="col-md-12">
                <ul class="list-group">
                    <div class="panel-group" id="accordion">
                    </div>
                </ul>
            </div>

        </div>


    </div>
</div>

<script>
        var mysqlData = {};
        var prestoData = {};
        var elementMysqlData;
        var elementPrestoData;

        var selectedVoType = "campaign";

        $(document).ready(function() {
            elementMysqlData = $("#mysql_data");
            elementPrestoData = $("#presto_data");
        });


</script>

<script>
    function loadMysqlData() {

        elementMysqlData.val("");
        mysqlData = {};

        var clientId = $("#client_id_10").val();
        if (clientId == null) {
            return;
        }

        $.get( "/api/dmt/mysql/" + clientId + "/campaign", function( response ) {
            mysqlData = response;
            var prestoDataString = JSON.stringify(mysqlData, undefined, 2);
            elementMysqlData.val(prestoDataString);

            compare();

        });
    };
</script>

<script>
    function loadPrestoData() {

        elementPrestoData.val("");
        prestoData = {};

        var clientId = $("#client_id_20").val();
        if (clientId == null) {
            return;
        }

        $.get( "/api/dmt/presto/" + clientId + "/campaign", function(response) {
            prestoData = response
            var prestoDataString = JSON.stringify(prestoData, undefined, 2);
            elementPrestoData.val(prestoDataString);

            compare();
        });
    };
</script>

<script>
    function compare() {

        $('#accordion').empty();

        if ($.isEmptyObject(mysqlData) || $.isEmptyObject(prestoData)) {
            return;
        }

        var accordionIndex = 1;
        for (var compareItemKey in mysqlData) {
            var createdElements = createAddionPanel(compareItemKey, accordionIndex++);

            var mysqlItems = mysqlData[compareItemKey];
            var prestoItems = prestoData[compareItemKey];
            if (prestoItems == null) {
                prestoItems = {};
            }

            var rowContainer = createdElements['tableBody'];
            for (var column in mysqlItems) {
                createComparisonRow(rowContainer, column, mysqlItems[column], prestoItems[column]);
            }

            for (var column in prestoItems) {
                if ( !(column in mysqlItems)) {
                    createComparisonRow(rowContainer, column, mysqlItems[column], prestoItems[column]);
                }
            } 
        }

        for (var compareItemKey in prestoData) {

            if (compareItemKey in mysqlData) {
                continue;
            }

            var createdElements = createAddionPanel(compareItemKey, accordionIndex++);

            var mysqlItems = {};
            var prestoItems = prestoData[compareItemKey];

            var rowContainer = createdElements['tableBody'];
            for (var column in prestoItems) {
                createComparisonRow(rowContainer, column, "", prestoItems[column]);
            }

        }

    };
</script>

<script>
    function createAddionPanel(title, accordionIndex) {

        var createdElements = {};

        var rootDiv = $("<div></div>").addClass("panel panel-default");
        $('#accordion').append(rootDiv);

        var panelHeadingDiv = $("<div></div>").addClass("panel-heading");
        rootDiv.append(panelHeadingDiv);

        var panelTitleDiv = $("<h4></h4").addClass("panel-title");
        panelHeadingDiv.append(panelTitleDiv);

        var linkElement = $("<a></a>").attr("data-toggle", "collapse")
                                        .attr("data-parent", "#accordion")
                                        .attr("href", "#collapse" + accordionIndex)
                                        .text(title);
        panelTitleDiv.append(linkElement);
        createdElements['title'] = linkElement;

        // the "in" attribute shows up the collapsed panel, without it, it's hidden
        var bodyRootDiv = $("<div></div>").addClass("panel-collapse collapse").attr("id", "collapse" + accordionIndex);
        rootDiv.append(bodyRootDiv);

        //<div class="panel-body text-center">
        var panelBody = $("<div></div>").addClass("panel-body text-center");
        bodyRootDiv.append(panelBody);

        // below is for each comparison key like object_count
        var itemRowContainer = $("<div></div>").addClass("row");
        panelBody.append(itemRowContainer);
        createdElements['rowContainer'] = itemRowContainer;

        var table = $("<table></table>").addClass("table table-bordered");
        itemRowContainer.append(table);

        var tableHead = $('<thead><tr><th>1.0 (Mysql)</th><th>Field</th><th>2.0 (Presto)</th></tr></thead>');
        table.append(tableHead);

        var tableBody = $('<tbody></tbody');
        table.append(tableBody);
        createdElements['tableBody'] = tableBody;

        return createdElements;

    };
</script>

<script>
    function createComparisonRow(tableBody, columnName, mysqlValue, prestoValue) {

        var createdElements = {};

        var tr = $("<tr></tr>");
        tableBody.append(tr);

        var tdMysql = $("<td></td>").text(mysqlValue);
        var tdFieldName = $("<td></td>").text(columnName);
        var tdPresto = $("<td></td>").text(prestoValue);

        tr.append(tdMysql);
        tr.append(tdFieldName);
        tr.append(tdPresto);

        if (mysqlValue == null || prestoValue == null) {
            return;
        }

        if (mysqlValue == prestoValue) {
            tr.addClass("success");
        } else {
            tr.addClass("danger");
        }
    }
</script>

<script>
    function selectedVoTypeChanged() {

        var elementIds = ["vo_campaign", "vo_group", "vo_keyword", "vo_creative"];
        for (var elementId in elementIds) {
                var element = $("#" + elementId);
                if (element.checked == true) {
                return element.val();
            }
        }

        return "";
    };
</script>

</body>
</html>