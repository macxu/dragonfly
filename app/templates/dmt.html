<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <title>Dragonfly | Test Management Portal </title>

    <link href="/static/images/dragonfly-icon.png" rel="icon"><!-- Bootstrap Core CSS-->
    <link href="/static/css/c3.min.css" rel="stylesheet">
    <link href="/static/css/bootstrap.min.css" rel="stylesheet"><!-- Custom CSS-->
    <link href="/static/css/sb-admin.css" rel="stylesheet"><!-- Morris Charts CSS-->
    <link href="/static/css/test-manager.css" rel="stylesheet"><!-- Custom Fonts-->
    <link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries--><!-- WARNING: Respond.js doesn't work if you view the page via file://--><!--if lt IE 9script(src='https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js')
script(src='https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js')--><!-- Morris Charts JavaScript--><!-- jQuery-->

    <script src="/static/js/jquery.js"></script>

    <script src="/static/js/bootstrap.min.js"></script>

</head>

<body>
<div id="wrapper-wide">
    <!-- Navigation-->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display-->
        <div class="navbar-header">
            <button class="navbar-toggle" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><img class="logo navbar-logo" src="/static/images/dragonfly-icon.png"><a class="navbar-brand" href="/">Dragonfly | Test Management Portal</a>
        </div><!-- Top Menu Items-->

    </nav>
    <div id="page-wrapper">
        <div class="container-fluid" id="divContainer">
            <!-- Page Heading-->

            <div class="row">
                <div class="panel panel-default">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-body">

                                <div class="row panel panel-default">
                                    <div class="col-sm-12">
                                        <div class="row" style="height:100%">
                                            <form>
                                                <div class="radio text-center">
                                                    <label><input id="vo_campaign" type="radio" name="optradio" checked="checked" onchange="selectedVoTypeChanged()"> Campaign </label>
                                                    <label><input id="vo_group" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Group </label>
                                                    <label><input id="vo_keyword" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Keyword </label>
                                                    <label><input id="vo_creative" type="radio" name="optradio" onchange="selectedVoTypeChanged()"> Creative </label>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <div class="row panel panel-default">
                                    <div class="col-xs-6">
                                        <div class="row panel panel-default">
                                            <div class="col-xs-8">
                                                <input type="text" class="form-control" id="client_id_10" value="12654910">
                                            </div>
                                            <div class="col-xs-4">
                                                <button type="button" class="btn btn-primary" onclick="loadMysqlData()">Get 1.0 Data by client ID</button>
                                            </div>
                                        </div>

                                        <div class="row panel panel-default">
                                            <div class="form-group">
                                              <textarea class="form-control" rows="20" id="mysql_data"></textarea>
                                            </div>
                                        </div>
                                    </div>


                                    <div class="col-xs-6">
                                        <div class="row panel panel-default">
                                            <div class="col-xs-8">
                                                <input type="text" class="form-control" id="client_id_20" value="4338988">
                                            </div>
                                            <div class="col-xs-4">
                                                <button type="button" class="btn btn-primary" onclick="loadPrestoData()">Get 2.0 Data by client ID</button>
                                            </div>
                                        </div>

                                         <div class="row panel panel-default">
                                            <div class="form-group">
                                              <textarea class="form-control" rows="20" id="presto_data"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row panel panel-default">
                                    <div class="col-sm-12">
                                        <div class="row panel panel-default" style="height:100%">
                                            <ul class="list-group">
                                                <div class="panel-group" id="accordion">
                                                </div>
                                            </ul>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>
</div>

<script>
        var mysqlData = {};
        var prestoData = {};
        var elementMysqlData;
        var elementPrestoData;

        var selectedVoType = "campaign";

        $(document).ready(function() {
            elementMysqlData = $("#mysql_data");
            elementPrestoData = $("#presto_data");
        });


</script>

<script>
    function loadMysqlData() {

        elementMysqlData.val("");
        mysqlData = {};

        var clientId = $("#client_id_10").val();
        if (clientId == null) {
            return;
        }

        $.get( "/api/dmt/mysql/" + clientId + "/campaign", function( response ) {
            mysqlData = response;
            var prestoDataString = JSON.stringify(mysqlData, undefined, 2);
            elementMysqlData.val(prestoDataString);

            compare();

        });
    };
</script>

<script>
    function loadPrestoData() {

        elementPrestoData.val("");
        prestoData = {};

        var clientId = $("#client_id_20").val();
        if (clientId == null) {
            return;
        }

        $.get( "/api/dmt/presto/" + clientId + "/campaign", function(response) {
            prestoData = response
            var prestoDataString = JSON.stringify(prestoData, undefined, 2);
            elementPrestoData.val(prestoDataString);

            compare();
        });
    };
</script>

<script>
    function compare() {
        if ($.isEmptyObject(mysqlData) || $.isEmptyObject(prestoData)) {
            return;
        }

        var accordionIndex = 1;
        for (var compareItemKey in mysqlData) {
            var createdElements = createAddionPanel(compareItemKey, accordionIndex++);

            var mysqlItems = mysqlData[compareItemKey];
            var prestoItems = prestoData[compareItemKey];
            if (prestoItems == null) {
                prestoItems = {};
            }

            var rowContainer = createdElements['rowContainer'];
            for (var column in mysqlItems) {
                createComparisonRow(rowContainer, column, mysqlItems[column], prestoItems[column]);
            }

            for (var column in prestoItems) {
                if ( !(column in mysqlItems)) {
                    createComparisonRow(rowContainer, column, mysqlItems[column], prestoItems[column]);
                }
            } 
        }

        for (var compareItemKey in prestoData) {

            if (compareItemKey in mysqlData) {
                continue;
            }

            var createdElements = createAddionPanel(compareItemKey, accordionIndex++);

            var mysqlItems = {};
            var prestoItems = prestoData[compareItemKey];

            var rowContainer = createdElements['rowContainer'];
            for (var column in prestoItems) {
                createComparisonRow(rowContainer, column, "", prestoItems[column]);
            }

        }

    };
</script>

<script>
    function createAddionPanel(title, accordionIndex) {

        var createdElements = {};

        var rootDiv = $("<div></div>").addClass("panel panel-default");
        $('#accordion').append(rootDiv);

        var panelHeadingDiv = $("<div></div>").addClass("panel-heading");
        rootDiv.append(panelHeadingDiv);

        var panelTitleDiv = $("<h4></h4").addClass("panel-title");
        panelHeadingDiv.append(panelTitleDiv);

        var linkElement = $("<a></a>").attr("data-toggle", "collapse")
                                        .attr("data-parent", "#accordion")
                                        .attr("href", "#collapse" + accordionIndex)
                                        .text(title);
        panelTitleDiv.append(linkElement);
        createdElements['title'] = linkElement;

        var bodyRootDiv = $("<div></div>").addClass("panel-collapse collapse in").attr("id", "collapse" + accordionIndex);
        rootDiv.append(bodyRootDiv);

        //<div class="panel-body text-center">
        var panelBody = $("<div></div>").addClass("panel-body text-center");
        bodyRootDiv.append(panelBody);

        // below is for each comparison key like object_count
        var itemRowContainer = $("<div></div>").addClass("row");
        panelBody.append(itemRowContainer);
        createdElements['rowContainer'] = itemRowContainer;

        return createdElements;

    };
</script>

<script>
    function createComparisonRow(parentElement, columnName, mysqlValue, prestoValue) {

        var createdElements = {};

        var itemRowContainer = $("<div></div>").addClass("row");
        parentElement.append(itemRowContainer);

        var itemRowMysqlDiv = $("<div></div>").addClass("col-xs-4 text-right").text(mysqlValue);
        itemRowContainer.append(itemRowMysqlDiv);
        createdElements['mysql'] = itemRowMysqlDiv;

        var itemRowColumnNameDiv = $("<div></div>").addClass("col-xs-4");
        itemRowContainer.append(itemRowColumnNameDiv);

        var itemRowColumnNameButton = $("<button></button>").attr("type", "button").addClass("btn btn-primary btn-block").text(columnName);
        itemRowColumnNameDiv.append(itemRowColumnNameButton);
        createdElements['button'] = itemRowColumnNameButton;

        var itemRowPrestoDiv = $("<div></div>").addClass("col-xs-4 text-left").text(prestoValue);
        itemRowContainer.append(itemRowPrestoDiv);
        createdElements['presto'] = itemRowPrestoDiv;

        return createdElements;
    }
</script>

<script>
    function selectedVoTypeChanged() {

        var elementIds = ["vo_campaign", "vo_group", "vo_keyword", "vo_creative"];
        for (var elementId in elementIds) {
                var element = $("#" + elementId);
                if (element.checked == true) {
                return element.val();
            }
        }

        return "";
    };
</script>

</body>
</html>